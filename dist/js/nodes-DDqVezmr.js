const n="nodes";class l{constructor(e){this.element=e,this.id=e.data("id"),this.level=e.data("level")}getStorage(){return i.get(this.id)}makeSortable(e){return this.element.parent().sortable(e)}toggleChildVisibility(){this.getStorage().setCollapsed(!this.getStorage().isCollapsed()),this.isCollapsed()?this.element.removeClass("collapsed"):this.element.addClass("collapsed")}isCollapsed(){return this.element.hasClass("collapsed")}getParent(){const e="li[data-level="+--this.level+"]";return new l(this.element.closest(e))}getLeftSibling(){return new l(this.element.prev("li[data-id]"))}getRightSibling(){return new l(this.element.next("li[data-id]"))}}class i{static getStored(){return typeof jQuery.cookie(n)>"u"&&i.save({}),JSON.parse(jQuery.cookie(n))}static get(e){let t=this.getStored();return typeof t[e]>"u"&&(t[e]=!0,i.save(t)),new r(e,t[e])}static saveItem(e){let t=this.getStored();t[e.id]=e.getContents(),i.save(t)}static save(e){jQuery.cookie(n,JSON.stringify(e))}}class r{constructor(e,t={}){this.id=e,this.contents=t}getContents(){return this.contents}isCollapsed(){return this.contents}setCollapsed(e){this.contents=e,this.save()}save(){i.saveItem(this)}}jQuery(document).ready(()=>{let o=jQuery("body.controller-nodes"),e=jQuery(".collection");o.on("click",".dialog .node-cell label",function(){jQuery(".dialog .node-cell label").removeClass("selected"),jQuery(this).addClass("selected")}),e.ready(()=>{const t=jQuery("[name=_token]:first").val();e.find("ul[data-level] > li").each(function(){let s=new l(jQuery(this));s.element.on("click","> .collapser-cell > .collapser",()=>s.toggleChildVisibility()),s.makeSortable({items:"> li",stop:(c,a)=>{s=new l(a.item),jQuery.post(window.NODE_REPOSITION_BASEPATH,{_token:t,id:s.id,toLeftId:s.getLeftSibling().id,toRightId:s.getRightSibling().id})}})})})});
